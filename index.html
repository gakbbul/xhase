<!DOCTYPE html>
<html lang="ko" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GAKBBUL - Private Hub</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Babel Standalone for in-browser compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              slate: {
                850: '#152033',
                950: '#020617', // Darker base
              }
            }
          },
        },
      }
    </script>
    <style>
      body {
        background-color: #0f172a; /* Slate 900 base */
        color: #f8fafc;
        overflow-x: hidden;
      }
      /* Custom scrollbar for webkit */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: #0f172a;
      }
      ::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 4px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #475569;
      }
      .custom-scrollbar::-webkit-scrollbar {
        width: 6px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: transparent;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #334155;
        border-radius: 3px;
      }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/client": "https://aistudiocdn.com/react-dom@^19.2.0/client",
    "firebase/app": "https://aistudiocdn.com/firebase@^12.6.0/app",
    "firebase/firestore": "https://aistudiocdn.com/firebase@^12.6.0/firestore",
    "lucide-react": "https://aistudiocdn.com/lucide-react@^0.554.0",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.30.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "firebase/": "https://aistudiocdn.com/firebase@^12.6.0/"
  }
}
</script>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
      import React, { useState, useEffect } from 'react';
      import ReactDOM from 'react-dom/client';
      import { initializeApp } from 'firebase/app';
      import { 
        getFirestore, 
        collection, 
        addDoc, 
        deleteDoc, 
        doc, 
        onSnapshot, 
        query, 
        orderBy 
      } from 'firebase/firestore';
      import { 
        ExternalLink, 
        Globe, 
        Search, 
        Lock, 
        Settings, 
        X, 
        Trash2, 
        Plus, 
        Sparkles, 
        Loader2,
        CheckCircle2,
        AlertCircle
      } from 'lucide-react';
      import { GoogleGenAI } from '@google/genai';

      // --- ENVIRONMENT SETUP ---
      // GitHub Pages와 같은 정적 호스팅 환경을 위한 process.env 폴리필
      if (typeof process === 'undefined') {
        window.process = { env: { API_KEY: '' } }; // 여기에 실제 API 키를 넣어야 빌드 과정 없이 작동합니다.
      }

      // --- CONSTANTS ---
      const APP_PASSWORD = "121212";
      const ADMIN_PASSWORD = "minchan1210";

      const FIREBASE_CONFIG = {
        apiKey: "AIzaSyBBBS6gZ_DfFilW_nl_MADO5x3fBAtkONw",
        authDomain: "gakbbul.firebaseapp.com",
        projectId: "gakbbul",
        storageBucket: "gakbbul.firebasestorage.app",
        messagingSenderId: "dummy-sender-id", 
        appId: "1:dummy:web:dummy"
      };

      // --- SERVICES: Firebase ---
      const app = initializeApp(FIREBASE_CONFIG);
      const db = getFirestore(app);
      const SITES_COLLECTION = "sites";

      const subscribeToSites = (onUpdate, onError) => {
        const q = query(collection(db, SITES_COLLECTION), orderBy("createdAt", "desc"));
        return onSnapshot(q, (snapshot) => {
          const sites = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          onUpdate(sites);
        }, (error) => {
          console.error("Firebase Snapshot Error:", error);
          if (onError) onError(error);
        });
      };

      const addSite = async (data) => {
        try {
          const urlObj = new URL(data.url.startsWith('http') ? data.url : `https://${data.url}`);
          const name = urlObj.hostname.replace('www.', '');
          
          await addDoc(collection(db, SITES_COLLECTION), {
            ...data,
            name,
            createdAt: Date.now()
          });
          console.log("Site added successfully to Firebase");
        } catch (error) {
          console.error("Error adding site:", error);
          throw error;
        }
      };

      const deleteSite = async (id) => {
        try {
          await deleteDoc(doc(db, SITES_COLLECTION, id));
        } catch (error) {
          console.error("Error deleting site:", error);
          throw error;
        }
      };

      // --- SERVICES: Gemini ---
      const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });

      const generateSiteDescription = async (title, url) => {
        try {
          const prompt = `
            웹사이트 정보:
            URL: ${url}
            제목: ${title}

            요청사항:
            이 웹사이트에 대한 짧고 매력적이며 전문적인 설명을 한국어로 작성해주세요.
            제약사항:
            1. 최대 2문장으로 작성할 것.
            2. 이모지는 사용하지 말 것.
            3. 명확하고 간결하게 작성할 것.
          `;

          const response = await ai.models.generateContent({
            model: 'gemini-2.5-flash',
            contents: prompt,
          });

          return response.text.trim();
        } catch (error) {
          console.error("Gemini API Error:", error);
          return "설명을 생성하는 중 오류가 발생했습니다. 직접 입력해주세요.";
        }
      };

      // --- COMPONENTS: SiteCard ---
      const SiteCard = ({ site }) => {
        const handleCardClick = () => {
          const targetUrl = site.url.startsWith('http') ? site.url : `https://${site.url}`;
          window.open(targetUrl, '_blank', 'noopener,noreferrer');
        };

        return (
          <div 
            onClick={handleCardClick}
            className="group relative flex flex-col justify-between h-48 p-5 bg-slate-900/50 backdrop-blur-sm border border-slate-800 rounded-2xl cursor-pointer hover:border-blue-500/50 hover:shadow-lg hover:shadow-blue-500/10 transition-all duration-300 overflow-hidden"
          >
            <div className="absolute top-0 right-0 w-24 h-24 bg-blue-500/5 rounded-full blur-2xl -mr-10 -mt-10 pointer-events-none group-hover:bg-blue-500/10 transition-colors" />

            <div>
              <div className="flex items-center justify-between mb-3">
                <div className="flex items-center space-x-2 text-slate-400">
                  <Globe size={14} />
                  <span className="text-xs font-medium tracking-wide uppercase opacity-70 truncate max-w-[150px]">
                    {site.name}
                  </span>
                </div>
                <ExternalLink size={16} className="text-slate-600 group-hover:text-blue-400 transition-colors" />
              </div>

              <h3 className="text-lg font-bold text-slate-100 mb-2 leading-tight line-clamp-1 group-hover:text-blue-100 transition-colors">
                {site.title}
              </h3>

              <p className="text-sm text-slate-400 leading-relaxed line-clamp-3">
                {site.description}
              </p>
            </div>
          </div>
        );
      };

      // --- COMPONENTS: AdminModal ---
      const AdminModal = ({ isOpen, onClose, sites, isDbConnected }) => {
        const [isAdminUnlocked, setIsAdminUnlocked] = useState(false);
        const [passwordInput, setPasswordInput] = useState('');
        const [error, setError] = useState('');
        
        const [formData, setFormData] = useState({ url: '', title: '', description: '' });
        const [isGenerating, setIsGenerating] = useState(false);
        const [isSubmitting, setIsSubmitting] = useState(false);

        useEffect(() => {
          if (!isOpen) {
            setPasswordInput('');
            setError('');
          }
        }, [isOpen]);

        const handleAuth = (e) => {
          e.preventDefault();
          if (passwordInput === ADMIN_PASSWORD) {
            setIsAdminUnlocked(true);
            setError('');
          } else {
            setError('비밀번호가 올바르지 않습니다.');
          }
        };

        const handleGenerateAI = async () => {
          if (!formData.url || !formData.title) {
            alert('URL과 제목을 먼저 입력해주세요.');
            return;
          }
          
          setIsGenerating(true);
          try {
            const description = await generateSiteDescription(formData.title, formData.url);
            setFormData(prev => ({ ...prev, description }));
          } finally {
            setIsGenerating(false);
          }
        };

        const handleSubmit = async (e) => {
          e.preventDefault();
          if (!formData.url || !formData.title) return;

          setIsSubmitting(true);
          try {
            await addSite(formData);
            setFormData({ url: '', title: '', description: '' }); 
            alert('사이트가 성공적으로 추가되었습니다.');
          } catch (err) {
            console.error(err);
            alert('사이트 추가 실패: ' + err.message);
          } finally {
            setIsSubmitting(false);
          }
        };

        const handleDelete = async (id) => {
          if (window.confirm('정말 삭제하시겠습니까?')) {
            await deleteSite(id);
          }
        };

        if (!isOpen) return null;

        return (
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
            <div className="absolute inset-0 bg-black/80 backdrop-blur-md" onClick={onClose} />
            
            <div className="relative bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl w-full max-w-5xl h-[85vh] overflow-hidden flex flex-col">
              {/* Modal Header */}
              <div className="flex-none flex items-center justify-between p-6 border-b border-slate-800 bg-slate-900/50 backdrop-blur">
                <div className="flex items-center gap-4">
                  <h2 className="text-xl font-bold text-white flex items-center gap-2">
                    {isAdminUnlocked ? '사이트 관리 (Admin)' : '관리자 접근'}
                  </h2>
                  {isAdminUnlocked && (
                     <div className={`flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-medium border ${isDbConnected ? 'bg-green-500/10 border-green-500/20 text-green-400' : 'bg-red-500/10 border-red-500/20 text-red-400'}`}>
                       {isDbConnected ? <CheckCircle2 size={12} /> : <AlertCircle size={12} />}
                       {isDbConnected ? 'DB 연동됨' : 'DB 연결 끊김'}
                     </div>
                  )}
                </div>
                <button onClick={onClose} className="text-slate-400 hover:text-white transition-colors">
                  <X size={24} />
                </button>
              </div>

              {/* Modal Body */}
              <div className="flex-1 overflow-hidden">
                {!isAdminUnlocked ? (
                  <div className="flex flex-col items-center justify-center h-full space-y-4">
                    <div className="p-4 bg-slate-800 rounded-full mb-2">
                      <Lock size={32} className="text-blue-500" />
                    </div>
                    <p className="text-slate-400">관리자 비밀번호를 입력하세요.</p>
                    <form onSubmit={handleAuth} className="w-full max-w-xs space-y-2">
                      <input
                        type="password"
                        value={passwordInput}
                        onChange={(e) => setPasswordInput(e.target.value)}
                        className="w-full px-4 py-3 bg-slate-950 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-blue-500 transition-colors"
                        placeholder="Password"
                        autoFocus
                      />
                      {error && <p className="text-red-500 text-sm text-center">{error}</p>}
                      <button
                        type="submit"
                        className="w-full py-3 bg-blue-600 hover:bg-blue-500 text-white font-semibold rounded-lg transition-colors"
                      >
                        잠금 해제
                      </button>
                    </form>
                  </div>
                ) : (
                  <div className="flex flex-col lg:flex-row h-full">
                    {/* Left Column: List */}
                    <div className="flex-1 flex flex-col h-1/2 lg:h-full border-b lg:border-b-0 lg:border-r border-slate-800">
                      <div className="p-4 border-b border-slate-800/50 bg-slate-900/30">
                        <h3 className="text-slate-400 font-medium text-sm">등록된 사이트 ({sites.length})</h3>
                      </div>
                      <div className="flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar">
                        {sites.length === 0 && (
                          <div className="text-center py-10 text-slate-600">등록된 사이트가 없습니다.</div>
                        )}
                        {sites.map(site => (
                          <div key={site.id} className="flex items-center justify-between p-4 bg-slate-800/50 rounded-xl border border-slate-700/50 hover:border-slate-600 transition-colors group">
                            <div className="flex-1 min-w-0 mr-4">
                              <div className="font-medium text-slate-200 truncate">{site.title}</div>
                              <div className="text-xs text-slate-500 truncate">{site.url}</div>
                            </div>
                            <button 
                              onClick={() => handleDelete(site.id)}
                              className="p-2 text-slate-500 hover:text-red-400 hover:bg-red-400/10 rounded-lg transition-all opacity-0 group-hover:opacity-100"
                            >
                              <Trash2 size={18} />
                            </button>
                          </div>
                        ))}
                      </div>
                    </div>

                    {/* Right Column: Add Form */}
                    <div className="flex-none lg:w-[400px] bg-slate-950/30 flex flex-col h-1/2 lg:h-full overflow-y-auto custom-scrollbar">
                      <div className="p-6">
                        <h3 className="text-slate-200 font-medium mb-6 flex items-center gap-2">
                          <Plus size={18} className="text-blue-500" /> 새 사이트 추가
                        </h3>
                        <form onSubmit={handleSubmit} className="space-y-4">
                          <div>
                            <label className="block text-xs font-medium text-slate-500 mb-1">URL</label>
                            <input
                              type="text"
                              value={formData.url}
                              onChange={(e) => setFormData({...formData, url: e.target.value})}
                              placeholder="example.com"
                              className="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors"
                              required
                            />
                          </div>
                          <div>
                            <label className="block text-xs font-medium text-slate-500 mb-1">사이트 제목</label>
                            <input
                              type="text"
                              value={formData.title}
                              onChange={(e) => setFormData({...formData, title: e.target.value})}
                              placeholder="My Awesome Site"
                              className="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors"
                              required
                            />
                          </div>
                          <div>
                            <div className="flex justify-between items-center mb-1">
                              <label className="block text-xs font-medium text-slate-500">설명</label>
                              <button
                                type="button"
                                onClick={handleGenerateAI}
                                disabled={isGenerating || !formData.url || !formData.title}
                                className="text-xs flex items-center gap-1 text-blue-400 hover:text-blue-300 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
                              >
                                {isGenerating ? <Loader2 size={12} className="animate-spin" /> : <Sparkles size={12} />}
                                AI 자동 생성
                              </button>
                            </div>
                            <textarea
                              value={formData.description}
                              onChange={(e) => setFormData({...formData, description: e.target.value})}
                              placeholder="Gemini가 설명을 작성해줍니다..."
                              rows={3}
                              className="w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-colors resize-none"
                            />
                          </div>
                          <button
                            type="submit"
                            disabled={isSubmitting}
                            className="w-full py-3 mt-2 bg-blue-600 hover:bg-blue-500 disabled:bg-blue-600/50 text-white font-semibold rounded-lg transition-colors flex items-center justify-center gap-2"
                          >
                            {isSubmitting && <Loader2 size={18} className="animate-spin" />}
                            추가하기
                          </button>
                        </form>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      };

      // --- COMPONENT: LockScreen ---
      const LockScreen = ({ onUnlock }) => {
        const [password, setPassword] = useState('');
        const [error, setError] = useState('');

        const handleSubmit = (e) => {
          e.preventDefault();
          if (password === APP_PASSWORD) {
            onUnlock();
          } else {
            setError('접근 권한이 없습니다.');
            setPassword('');
          }
        };

        return (
          <div className="min-h-screen bg-slate-950 flex flex-col items-center justify-center p-4">
            <div className="w-full max-w-md bg-slate-900/50 border border-slate-800 p-8 rounded-2xl shadow-2xl backdrop-blur-md">
              <div className="flex flex-col items-center mb-8">
                <div className="p-4 bg-slate-800 rounded-full mb-4 ring-1 ring-slate-700">
                  <Lock size={40} className="text-blue-500" />
                </div>
                <h1 className="text-2xl font-bold text-white tracking-wider">RESTRICTED ACCESS</h1>
                <p className="text-slate-400 mt-2 text-sm">보안 비밀번호를 입력해주세요.</p>
              </div>

              <form onSubmit={handleSubmit} className="space-y-4">
                <input
                  type="password"
                  value={password}
                  onChange={(e) => setPassword(e.target.value)}
                  className="w-full px-4 py-3 bg-slate-950 border border-slate-700 rounded-lg text-center text-white text-lg tracking-widest focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all placeholder:text-slate-600"
                  placeholder="••••••"
                  autoFocus
                />
                {error && <p className="text-red-500 text-sm text-center font-medium animate-pulse">{error}</p>}
                <button
                  type="submit"
                  className="w-full py-3 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded-lg transition-all transform hover:scale-[1.02] active:scale-[0.98]"
                >
                  ENTER SYSTEM
                </button>
              </form>
            </div>
          </div>
        );
      };

      // --- COMPONENT: App ---
      const App = () => {
        const [isAppUnlocked, setIsAppUnlocked] = useState(false);
        const [isAdminModalOpen, setIsAdminModalOpen] = useState(false);
        const [searchQuery, setSearchQuery] = useState('');
        const [sites, setSites] = useState([]);
        const [loading, setLoading] = useState(true);
        const [isDbConnected, setIsDbConnected] = useState(false);

        useEffect(() => {
          const unlocked = sessionStorage.getItem('gakbbul_unlocked');
          if (unlocked === 'true') {
            setIsAppUnlocked(true);
          }
          setLoading(false);
        }, []);

        useEffect(() => {
          if (!isAppUnlocked) return;
          const unsubscribe = subscribeToSites(
            (updatedSites) => {
              setSites(updatedSites);
              setIsDbConnected(true);
            },
            (error) => {
              setIsDbConnected(false);
            }
          );
          return () => unsubscribe();
        }, [isAppUnlocked]);

        const handleUnlock = () => {
          setIsAppUnlocked(true);
          sessionStorage.setItem('gakbbul_unlocked', 'true');
        };

        const filteredSites = sites.filter(site => 
          site.title.toLowerCase().includes(searchQuery.toLowerCase()) ||
          site.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
          site.description.toLowerCase().includes(searchQuery.toLowerCase())
        );

        if (loading) return null;

        if (!isAppUnlocked) {
          return <LockScreen onUnlock={handleUnlock} />;
        }

        return (
          <div className="min-h-screen bg-slate-950 text-white selection:bg-blue-500/30">
            {/* Header */}
            <header className="sticky top-0 z-40 w-full border-b border-slate-800/50 bg-slate-950/80 backdrop-blur-md supports-[backdrop-filter]:bg-slate-950/60">
              <div className="container mx-auto px-4 h-20 flex items-center justify-between gap-4">
                <div className="flex-shrink-0">
                  <h1 className="text-2xl md:text-3xl font-black tracking-tighter text-white bg-clip-text text-transparent bg-gradient-to-r from-white to-slate-400">
                    GAKBBUL
                  </h1>
                </div>

                <div className="flex-1 max-w-xl relative">
                  <div className="relative group">
                    <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-blue-400 transition-colors" size={18} />
                    <input
                      type="text"
                      value={searchQuery}
                      onChange={(e) => setSearchQuery(e.target.value)}
                      placeholder="검색어를 입력하세요..."
                      className="w-full bg-slate-900/50 border border-slate-800 rounded-xl py-2.5 pl-10 pr-4 text-sm text-slate-200 focus:outline-none focus:border-blue-500/50 focus:bg-slate-900 transition-all"
                    />
                  </div>
                </div>

                <button 
                  onClick={() => setIsAdminModalOpen(true)}
                  className="flex items-center gap-2 px-4 py-2 text-sm font-medium text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors whitespace-nowrap"
                >
                  <Settings size={18} />
                  <span>사이트 관리</span>
                </button>
              </div>
            </header>

            {/* Main Content */}
            <main className="container mx-auto px-4 py-8">
              {filteredSites.length === 0 ? (
                <div className="flex flex-col items-center justify-center py-20 text-slate-500">
                  <Search size={48} className="mb-4 opacity-20" />
                  <p className="text-lg">검색 결과가 없습니다.</p>
                </div>
              ) : (
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                  {filteredSites.map(site => (
                    <SiteCard key={site.id} site={site} />
                  ))}
                </div>
              )}
            </main>

            {/* Modals */}
            <AdminModal 
              isOpen={isAdminModalOpen} 
              onClose={() => setIsAdminModalOpen(false)} 
              sites={sites}
              isDbConnected={isDbConnected}
            />
          </div>
        );
      };

      // --- MOUNT ---
      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(
        <React.StrictMode>
          <App />
        </React.StrictMode>
      );
    </script>
  </body>
</html>